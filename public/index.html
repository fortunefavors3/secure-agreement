<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Surplus Funds Recovery Agreement</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 800px;
      margin: 40px auto;
      background: #fff;
      padding: 30px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      border-radius: 10px;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }

    input[type="text"],
    input[type="email"],
    input[type="number"] {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    #signature-pad {
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-top: 10px;
      width: 100%;
      height: 150px;
    }

    button {
      margin-top: 20px;
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      background: #3498db;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    button.clear-btn {
      background: #e74c3c;
      margin-left: 10px;
    }

    .agreement-text {
      background: #f0f0f0;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
      max-height: 250px;
      overflow-y: auto;
      font-size: 14px;
      line-height: 1.5;
    }

    .success {
      color: green;
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Surplus Funds Recovery Agreement</h1>

    <div class="agreement-text">
      <p>
        This agreement confirms your engagement with our Surplus Funds Recovery service. 
        You retain full ownership of any recovered funds. 
        Our fee is contingent on successful recovery and will be paid directly to us 
        after funds are recovered. By signing below, you agree to the terms of this service.
      </p>
    </div>

    <form id="agreement-form">
      <label for="name">Full Name</label>
      <input type="text" id="name" name="name" required>

      <label for="email">Email</label>
      <input type="email" id="email" name="email" required>

      <label for="feeAmount">Fee Amount ($)</label>
      <input type="number" id="feeAmount" name="feeAmount" required>

      <label>Signature</label>
      <canvas id="signature-pad"></canvas>
      <button type="button" class="clear-btn" id="clear-signature">Clear Signature</button>

      <button type="submit">Submit Agreement</button>
    </form>

    <div class="success" id="success-message" style="display:none;">
      Agreement submitted successfully!
    </div>
  </div>

  <script>
    // Signature Pad setup
    const canvas = document.getElementById('signature-pad');
    const ctx = canvas.getContext('2d');
    let drawing = false;

    canvas.addEventListener('mousedown', () => drawing = true);
    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mouseout', () => drawing = false);
    canvas.addEventListener('mousemove', draw);

    function draw(e) {
      if (!drawing) return;
      ctx.lineWidth = 2;
      ctx.lineCap = 'round';
      ctx.strokeStyle = '#000';
      const rect = canvas.getBoundingClientRect();
      ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
    }

    document.getElementById('clear-signature').addEventListener('click', () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.beginPath();
    });

    // Handle form submission
    document.getElementById('agreement-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const feeAmount = document.getElementById('feeAmount').value;
      const signature = canvas.toDataURL('image/png');

      try {
        const response = await fetch('/create-agreement', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, feeAmount, signature })
        });

        if (response.ok) {
          document.getElementById('success-message').style.display = 'block';
        } else {
          alert('Error submitting agreement.');
        }
      } catch (err) {
        alert('Network error.');
        console.error(err);
      }
    });
  </script>
</body>
</html>
